function bnhMenuItem(e){return{restrict:"A",link:function(n,i,o){n.$on("more-menu:overflow",function(){if("desktop"===e.getMediaQuery()){var t=n.$eval(o.option);t.isOverflow=i[0].offsetTop>0?!0:!1,t.isOverflow===!0&&t.index>0&&(n.options.mainmenu.children[t.index-1].isOverflow=!0)}})}}}function moreMenuService(e,n,i){function o(e,n,i){var o=[];return e.forEach(function(e){(!i||_.matches(i)(e))&&o.push(_.assign(e,n))}),o}function t(e){if(e.children&&O&&(e.children=O(e.children)),e.children&&e.children.length){e.hasDropdown=!0,e.columns=0===e.level&&_.filter(e.children,"children").length===e.children.length&&e.children.length||1;for(var n=0,i=e.children.length;i>n;n++){var o=e.children[n];o.level=e.level+1,o.index=n,o.isOpen=!1,t(o)}}else e.hasDropdown=!1,e.columns=0}function r(e){e.isOpen=!0}function l(e){e.isOpen=!1}function u(e,n){n.isOpen=!n.isOpen,n.isOpen?y.push(n):_.remove(y,{isOpen:!1}),y.length?(r(e),0===n.level&&e.$broadcast("more-menu:open")):l(e)}function s(e){for(;y.length;)y.shift().isOpen=!1;l(e)}function c(){return b="desktop"}function m(e){O=e}function a(){return b}function d(){return w}function h(){return $}function p(){return i.pageYOffset}function f(){if("desktop"===moreMenuService.getMediaQuery()){var e=moreMenuService.getScrollOffset(),n=e>M?"down":"up";if(M=e,100>=e)return!1;if(e>100&&"down"===n)return!0}return null}function g(e,i){angular.isFunction(i)&&(i={post:i});var o,t=e.contents().remove();return{pre:i&&i.pre?i.pre:null,post:function(e,r){o||(o=n(t)),o(e,function(e){r.append(e)}),i&&i.post&&i.post.apply(null,arguments)}}}function v(e,n,i){var o;i.fn?(_.isFunction(e[i.fn])?e[i.fn]():e.functions&&_.isFunction(e.functions[i.fn])&&e.functions[i.fn](),s(e)):i.isOverflow&&i.hasDropdown?u(e,i):i.root||"desktop"===b&&0===i.level&&i.hasDropdown?(o=i.isOpen,s(e),i.style="phone"===b?{"max-height":$-100+"px"}:{},o||u(e,i)):i.hasDropdown?u(e,i):s(e)}var w,$,b,O,y=[],M=0,k=i.jQuery?!0:!1,C={setProperty:o,setDefaultProperties:t,setMenuFilter:m,updateMediaQuery:c,getMediaQuery:a,getWindowWidth:d,getWindowHeight:h,getScrollOffset:p,getCollapsed:f,hasJQ:k,recursiveCompile:g,handleClick:v,closeAll:s,menuOn:r,menuOff:l};return C}angular.module("bnh.moremenu",["bnh.moremenu.templates"]),angular.module("bnh.moremenu").controller("bnhtest",["$scope",function(e){e.anotherTest="this works"}]).run(function(){console.log("this works")}),angular.module("bnh.moremenu").directive("moreMenuItem",["moreMenuService",bnhMenuItem]),angular.module("bnh.moremenu").directive("moreMenu",["$compile","$document","$http","$filter","$injector","$interpolate","$interval","$q","$timeout","$window","moreMenuService",function(e,n,i,o,t,r,l,u,s,c,m){return{restrict:"E",scope:{source:"=?",sourceJson:"=?",menuFilter:"=?"},templateUrl:"angular-more-menu/views/nav.html",link:function(e,n){function o(e){return!e.isHidden}function r(e){return e.isOverflow?!0:!1}function l(e){return e.sref&&g?v.href(e.sref):e.uri?e.uri:""}function a(n,i){s(function(){(i||0===e.$element.has(n.target).length)&&m.closeAll(e)})}function d(){if(e.collapse){var n=m.getCollapsed();null!==n&&(e.isCollapsed=n)}}function h(n,i){i&&(e.options[n].all=i),e.options[n].children=angular.copy(e.options[n].all)||[],m.setDefaultProperties(e.options[n]),e.redrawMenuItems()}function p(n){var o=u.defer();return w[n]?i.get(w[n]).then(function(i){i&&i.data?h(n,i.data):e.options[n].children=[],o.resolve()}):$[n]&&(h(n,$[n]),o.resolve()),o.promise}function f(){m.closeAll(e),m.updateMediaQuery(),e.options.mainmenu.isHidden=!1,m.setProperty(e.options.mainmenu.children,{isHidden:!1}),e.options.moremenu.isHidden=!0,e.options.moremenu.hasDropdown=!1,e.options.moremenu.children.splice(0,e.options.moremenu.children.length),"phone"===m.getMediaQuery()?e.options.mainmenu.isOpen=!1:s(function(){e.$apply(function(){e.$broadcast("more-menu:overflow");var n=angular.copy(m.setProperty(e.options.mainmenu.children,{isHidden:!0},{isOverflow:!0}));n&&n.length&&(m.setProperty(n,{level:1}),e.options.moremenu.children.push.apply(e.options.moremenu.children,n),e.options.moremenu.hasDropdown=!0,e.options.moremenu.isHidden=!1)})})}e.$element=angular.element(n),e.source||e.sourceJson||(e.sourceJson="data/mainmenu.json"),e.menuFilter&&m.setMenuFilter(e.menuFilter);var g=t.has("ui.router"),v=g?t.get("ui.router"):null,w={mainmenu:e.sourceJson},$={mainmenu:e.source};e.options={mainmenu:{title:"Menu",isHidden:!0,level:-1,children:[],root:!0},moremenu:{title:"More",isHidden:!0,level:0,children:[]}},e.redrawMenuItems=f,e.checkScrollState=d,e.documentClick=a;var b=_.throttle(function(){e.$apply(e.redrawMenuItems)},100),O=_.throttle(function(){e.$apply(e.checkScrollState)},200);angular.element(c).on("resize",b),angular.element(c).on("scroll",O),m.updateMediaQuery(),p("mainmenu").then(function(){e.redrawMenuItems()}),e.mainFilter=o,e.moreFilter=r,e.getOptionHref=l,e.$watch("breadcrumb",e.redrawMenuItems,!0),e.$watch("sourceJson",function(){e.sourceJson&&e.sourceJson!==w.mainmenu&&(w.mainmenu=e.sourceJson,p("mainmenu"))}),e.$watch("source",function(){e.source&&e.source!==$.mainmenu&&($.mainmenu=e.source,p("mainmenu"))}),e.$watch("pageTitleContent",function(n){var i=e.$element.find("#title-content");angular.isFunction(n)?(i.append(n()),e.showPageTitleContent=!0):(i.empty(),e.showPageTitleContent=!1)}),e.$watch("replacementPageTitleContent",function(n){var i=e.$element.find("#title-content"),o=angular.isFunction(n)?n():n;angular.isDefined(o)?(i.html(o),e.showPageTitleContent=!0):(i.empty(),e.showPageTitleContent=!1)})},controller:["$scope","$injector","$location","moreMenuService",function(e,n,i,o){var t=n.has("ui.router"),r=t?n.get("ui.router"):null;e.handleClick=function(n,i){o.handleClick(e,n,i)},e.isCurrentState=function(e){var n;return e.sref&&t?r.includes(e.sref):e.uri?(n=e.uri.substring(e.uri.indexOf("#")+1),0===i.path().indexOf(n)):void 0}}]}}]),angular.module("bnh.moremenu").factory("moreMenuService",["$filter","$compile","$window",moreMenuService]),angular.module("bnh.moremenu").directive("moreMenuSub",["$timeout","moreMenuService",function(e,n){return{restrict:"E",scope:{child:"=options"},templateUrl:"angular-more-menu/views/sub.html",compile:function(i){return n.recursiveCompile(i,function(i,o){i.subStyle={};var t=function(){i.child.isOpen&&"desktop"===n.getMediaQuery()&&(e(function(){if(!i.child.root){var e=n.hasJQ?o.parent().offset().left:o.parent()[0].offsetLeft,t=o.children().width();e+t>n.getWindowWidth()?i.subStyle.left="-"+(e+t-n.getWindowWidth()+30)+"px":delete i.subStyle.left}i.subStyle.maxHeight=n.getWindowHeight()-100+"px"},0),i.subStyle.opacity=1)};i.subStyle={},i.child&&0===i.child.level&&(i.$on("more-menu:open",function(){t()}),t()),i.handleClick=function(e,o){n.handleClick(i,e,o),i.$emit("more-menu:open")}})}}}]),angular.module("bnh.moremenu.templates",[]).run(["$templateCache",function(e){e.put("angular-more-menu/views/nav.html",'\n\n<nav class="more-menu" ng-class="{\'is-open\': options.mainmenu.isOpen, \'is-hidden\': options.mainmenu.isHidden}" ng-style="options.mainmenu.style">\n  <ul class="more-menu-items" role="menu">\n\n    <li more-menu-item class="more-menu-item" role="menuitem" ng-repeat="child in options.mainmenu.children" option="child" ng-class="{\'is-active\': isCurrentState(child), \'is-open\': child.isOpen, \'is-hidden\': child.isHidden }">\n      <a ng-click="handleClick($event, child)" ng-href="{{getOptionHref(child)}}" ng-class="{\'has-dropdown\': child.children}">\n        {{child.title}}\n      </a>\n      <more-menu-sub options="child"></more-menu-sub>\n    </li>\n\n    <li class="more-menu-item" role="menuitem" option="options.moremenu" ng-class="{\'is-open\': options.moremenu.isOpen, \'is-hidden\': options.moremenu.isHidden}">\n      <a class="has-dropdown" ng-click="handleClick($event, options.moremenu)">\n        {{options.moremenu.title}}\n      </a>\n      <more-menu-sub ng-if="options.moremenu.isOpen" options="options.moremenu"></more-menu-sub>\n    </li>\n  </ul>\n</nav>\n'),e.put("angular-more-menu/views/sub.html",'<div class="more-menu-sub" role="menu" ng-if="child.isOpen && child.children && child.children.length" ng-style="subStyle">\n  <div class="more-menu-sub-content">\n    <ul ng-if="!child.columns || child.columns <= 1">\n      <li class="more-menu-sub-item" role="menuitem" ng-repeat="child in child.children">\n        <a ng-click="handleClick($event, child)" ng-href="{{getOptionHref(child)}}" ng-if="!child.hasDropdown">\n          {{child.title}}\n        </a>\n        <div ng-if="child.hasDropdown">\n          <span class="has-dropdown" ng-click="handleClick($event, child)" ng-class="{\'is-open\': child.isOpen}">{{child.title}}</span>\n          <more-menu-sub ng-if="child.isOpen" options="child"></more-menu-sub>\n        </div>\n      </li>\n    </ul>\n    <ul ng-if="child.columns > 1" ng-repeat="column in child.children">\n      <li class="more-menu-sub-head">{{column.title}}</li>\n      <li class="more-menu-sub-item" role="menuitem" ng-repeat="child in column.children">\n        <a ng-click="handleClick($event, child)" ng-href="{{getOptionHref(child)}}" ng-if="!child.hasDropdown">\n          {{child.title}}\n        </a>\n        <span ng-if="child.hasDropdown">{{child.title}}</span>\n        <more-menu-sub ng-if="child.hasDropdown && child.isOpen" options="child"></more-menu-sub>\n      </li>\n    </ul>\n  </div>\n</div>\n')}]);