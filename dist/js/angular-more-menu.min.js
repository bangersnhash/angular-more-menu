!function(){"use strict";function e(e){return{restrict:"A",link:function(n,i,t){n.$on("bnh-responsive-nav:overflow",function(){if("desktop"===e.getMediaQuery()){var o=n.$eval(t.option);o.isOverflow=i.get(0).offsetTop>0?!0:!1,o.isOverflow===!0&&o.index>0&&(n.options.mainmenu.children[o.index-1].isOverflow=!0)}})}}}function n(e,i,t){function o(e,n,i){var t=[];return e.forEach(function(e){(!i||_.matches(i)(e))&&t.push(_.assign(e,n))}),t}function r(e){if(e.children&&y&&(e.children=y(e.children)),e.children&&e.children.length){e.hasDropdown=!0,e.columns=0===e.level&&_.filter(e.children,"children").length===e.children.length&&e.children.length||1;for(var n=0,i=e.children.length;i>n;n++){var t=e.children[n];t.level=e.level+1,t.index=n,t.isOpen=!1,r(t)}}else e.hasDropdown=!1,e.columns=0}function l(e){e.isOpen=!0}function u(e){e.isOpen=!1}function s(e,n){n.isOpen=!n.isOpen,n.isOpen?S.push(n):_.remove(S,{isOpen:!1}),S.length?(l(e),0===n.level&&e.$broadcast("more-menu:open")):u(e)}function c(e){for(;S.length;)S.shift().isOpen=!1;u(e)}function a(){return $=t.innerWidth,O=t.innerHeight,b=$>=600?"desktop":"phone"}function m(e){y=e}function d(){return b}function h(){return $}function p(){return O}function f(){return t.pageYOffset}function g(){if("desktop"===n.getMediaQuery()){var e=n.getScrollOffset(),i=e>M?"down":"up";if(M=e,100>=e)return!1;if(e>100&&"down"===i)return!0}return null}function v(e,n){angular.isFunction(n)&&(n={post:n});var t,o=e.contents().remove();return{pre:n&&n.pre?n.pre:null,post:function(e,r){t||(t=i(o)),t(e,function(e){r.append(e)}),n&&n.post&&n.post.apply(null,arguments)}}}function w(e,n,i){var t;i.fn?(_.isFunction(e[i.fn])?e[i.fn]():e.functions&&_.isFunction(e.functions[i.fn])&&e.functions[i.fn](),c(e)):i.isOverflow&&i.hasDropdown?s(e,i):i.root||"desktop"===b&&0===i.level&&i.hasDropdown?(t=i.isOpen,c(e),i.style="phone"===b?{"max-height":O-100+"px"}:{},t||s(e,i)):i.hasDropdown?s(e,i):c(e)}var $,O,b,y,S=[],M=0,k={setProperty:o,setDefaultProperties:r,setMenuFilter:m,updateMediaQuery:a,getMediaQuery:d,getWindowWidth:h,getWindowHeight:p,getScrollOffset:f,getCollapsed:g,recursiveCompile:v,handleClick:w,closeAll:c,menuOn:l,menuOff:u};return k}angular.module("bnh.moremenu",[]),angular.module("bnh.moremenu").directive("moreMenuItem",["moreMenuService",e]),angular.module("bnh.moremenu").directive("moreMenu",["$compile","$document","$http","$filter","$injector","$interpolate","$interval","$q","$timeout","$window","moreMenuService",function(e,n,i,t,o,r,l,u,s,c,a){return{restrict:"E",scope:{data:"=?",dataSource:"=?",menuFilter:"=?"},templateUrl:"angular-more-menu/views/nav.html",link:function(e,n){function t(e){return!e.isHidden}function r(e){return e.isOverflow?!0:!1}function l(n){return n.sref&&e.hasUiRouter?g.href(n.sref):n.uri?n.uri:""}function m(n,i){s(function(){(i||0===e.$element.has(n.target).length)&&a.closeAll(e)})}function d(){if(e.collapse){var n=a.getCollapsed();null!==n&&(e.isCollapsed=n)}}function h(n,i){i&&(e.options[n].all=i),e.options[n].children=angular.copy(e.options[n].all)||[],a.setDefaultProperties(e.options[n]),e.redrawMenuItems()}function p(n){var t=u.defer();return v[n]?i.get(v[n]).then(function(i){i&&i.data?h(n,i.data):e.options[n].children=[],t.resolve()}):w[n]&&(h(n,w[n]),t.resolve()),t}function f(){a.closeAll(e),a.updateMediaQuery(),e.options.mainmenu.isHidden=!1,a.setProperty(e.options.mainmenu.children,{isHidden:!1}),e.options.moremenu.isHidden=!0,e.options.moremenu.hasDropdown=!1,e.options.moremenu.children.splice(0,e.options.moremenu.children.length),"phone"===a.getMediaQuery()?e.options.mainmenu.isOpen=!1:s(function(){e.$apply(function(){e.$broadcast("more-menu:overflow");var n=angular.copy(a.setProperty(e.options.mainmenu.children,{isHidden:!0},{isOverflow:!0}));n&&n.length&&(a.setProperty(n,{level:1}),e.options.moremenu.children.push.apply(e.options.moremenu.children,n),e.options.moremenu.hasDropdown=!0,e.options.moremenu.isHidden=!1)})})}e.$element=$(n),e.dataSource||(e.dataSource="data/mainmenu.json"),e.menuFilter&&a.setMenuFilter(e.menuFilter),e.hasUiRouter=o.has("ui.router");var g=e.hasUiRouter?o.get("ui.router"):null,v={mainmenu:e.dataSource},w={mainmenu:e.data};e.options={mainmenu:{title:"Menu",isHidden:!0,level:-1,children:[],root:!0},moremenu:{title:"More",isHidden:!0,level:0,children:[]}},e.redrawMenuItems=f,e.checkScrollState=d,e.documentClick=m;var O=_.throttle(function(){e.$apply(e.redrawMenuItems)},100),b=_.throttle(function(){e.$apply(e.checkScrollState)},200);angular.element(c).on("resize",O),angular.element(c).on("scroll",b),a.updateMediaQuery(),p("mainmenu").then(function(){e.redrawMenuItems()}),h("mainmenu"),e.mainFilter=t,e.moreFilter=r,e.getOptionHref=l,e.$watch("breadcrumb",e.redrawMenuItems,!0),e.$watch("dataSource",function(){e.dataSource&&e.dataSource!==v.mainmenu&&(v.mainmenu=e.dataSource,p("mainmenu"))}),e.$watch("usermenuSource",function(){e.usermenuSource&&e.usermenuSource!==v.usermenu&&(v.usermenu=e.usermenuSource,p("usermenu"))}),e.$watch("pageTitleContent",function(n){var i=e.$element.find("#title-content");angular.isFunction(n)?(i.append(n()),e.showPageTitleContent=!0):(i.empty(),e.showPageTitleContent=!1)}),e.$watch("replacementPageTitleContent",function(n){var i=e.$element.find("#title-content"),t=angular.isFunction(n)?n():n;angular.isDefined(t)?(i.html(t),e.showPageTitleContent=!0):(i.empty(),e.showPageTitleContent=!1)})},controller:["$scope","$state","$location","moreMenuService",function(e,n,i,t){e.handleClick=function(n,i){t.handleClick(e,n,i)},e.isCurrentState=function(e){var t;return e.sref?n.includes(e.sref):e.uri?(t=e.uri.substring(e.uri.indexOf("#")+1),0===i.path().indexOf(t)):void 0}}]}}]),angular.module("bnh.moremenu").factory("moreMenuService",["$filter","$compile","$window",n]),angular.module("bnh.moremenu").directive("moreMenuSub",["$timeout","moreMenuService",function(e,n){return{restrict:"E",scope:{child:"=options"},templateUrl:"angular-more-menu/views/sub.html",compile:function(i){return n.recursiveCompile(i,function(i,t){i.subStyle={};var o=function(){i.child.isOpen&&"desktop"===n.getMediaQuery()&&(e(function(){if(!i.child.root){var e=t.parent().offset().left,o=t.children().width();e+o>n.getWindowWidth()?i.subStyle.left="-"+(e+o-n.getWindowWidth()+30)+"px":delete i.subStyle.left}i.subStyle.maxHeight=n.getWindowHeight()-100+"px"},0),i.subStyle.opacity=1)};i.subStyle={},i.child&&0===i.child.level&&(i.$on("more-menu:open",function(){o()}),o()),i.handleClick=function(e,t){n.handleClick(i,e,t),i.$emit("more-menu:open")}})}}}]),angular.module("bnh.moremenu",[]).run(["$templateCache",function(e){e.put("nav.html",'\n\n<nav class="more-menu" ng-class="{\'is-open\': options.mainmenu.isOpen, \'is-hidden\': options.mainmenu.isHidden}" ng-style="options.mainmenu.style">\n  <ul ng-show="showMainmenu" class="more-menu-items" role="menu">\n\n    <li more-menu-item class="more-menu-item" role="menuitem" ng-repeat="child in options.mainmenu.children" option="child" ng-class="{\'is-active\': isCurrentState(child), \'is-open\': child.isOpen, \'is-hidden\': child.isHidden }">\n      <a ng-click="handleClick($event, child)" ng-href="{{getOptionHref(child)}}" ng-class="{\'has-dropdown\': child.children}">\n        {{child.title}}\n      </a>\n      <more-menu-sub options="child"></more-menu-sub>\n    </li>\n\n    <li class="more-menu-item" role="menuitem" option="options.moremenu" ng-class="{\'is-open\': options.moremenu.isOpen, \'is-hidden\': options.moremenu.isHidden}">\n      <a class="has-dropdown" ng-click="handleClick($event, options.moremenu)">\n        {{options.moremenu.title}}\n      </a>\n      <more-menu-sub ng-if="options.moremenu.isOpen" options="options.moremenu"></more-menu-sub>\n    </li>\n  </ul>\n</nav>\n'),e.put("sub.html",'<div class="more-menu-sub" role="menu" ng-if="child.isOpen && child.children && child.children.length" ng-style="subStyle">\n  <div class="more-menu-sub-content">\n    <ul ng-if="!child.columns || child.columns <= 1">\n      <li class="more-menu-sub-item" role="menuitem" ng-repeat="child in child.children">\n        <a ng-click="handleClick($event, child)" ng-href="{{getOptionHref(child)}}" ng-if="!child.hasDropdown">\n          {{child.title}}\n        </a>\n        <div ng-if="child.hasDropdown">\n          <span class="has-dropdown" ng-click="handleClick($event, child)" ng-class="{\'is-open\': child.isOpen}">{{child.title}}</span>\n          <more-menu-sub ng-if="child.isOpen" options="child"></more-menu-sub>\n        </div>\n      </li>\n    </ul>\n    <ul ng-if="child.columns > 1" ng-repeat="column in child.children">\n      <li class="more-menu-sub-head">{{column.title}}</li>\n      <li class="more-menu-sub-item" role="menuitem" ng-repeat="child in column.children">\n        <a ng-click="handleClick($event, child)" ng-href="{{getOptionHref(child)}}" ng-if="!child.hasDropdown">\n          {{child.title}}\n        </a>\n        <span ng-if="child.hasDropdown">{{child.title}}</span>\n        <more-menu-sub ng-if="child.hasDropdown && child.isOpen" options="child"></more-menu-sub>\n      </li>\n    </ul>\n  </div>\n</div>\n')}])}();